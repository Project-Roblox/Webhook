<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VORTEX.AI</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: #0a0a0f;
  color: #e4e4e7;
  font-family: 'Courier New', monospace;
  height: 100vh;
  display: flex;
}

/* Sidebar z kodem */
.sidebar {
  width: 350px;
  background: #0d0d12;
  border-right: 2px solid #222;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.sidebar-header {
  padding: 15px;
  border-bottom: 1px solid #333;
  background: #0a0a0f;
}

.sidebar-header h3 {
  color: #8b5cf6;
  font-size: 14px;
  letter-spacing: 1px;
}

.code-preview {
  flex: 1;
  overflow-y: auto;
  padding: 15px;
  font-size: 12px;
  line-height: 1.5;
}

.code-preview pre {
  background: #000;
  padding: 10px;
  border-radius: 4px;
  overflow-x: auto;
  margin-bottom: 10px;
}

.code-preview code {
  color: #22c55e;
  font-family: 'Consolas', monospace;
}

.code-item {
  margin-bottom: 15px;
  padding-bottom: 15px;
  border-bottom: 1px solid #1a1a1a;
}

.code-item:last-child {
  border-bottom: none;
}

.code-label {
  color: #666;
  font-size: 11px;
  margin-bottom: 5px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Main Content */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* Header */
header {
  padding: 15px 25px;
  border-bottom: 2px solid #7c3aed;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #0d0d12;
}

h1 {
  color: #8b5cf6;
  font-size: 1.8em;
  letter-spacing: 2px;
}

.header-right {
  display: flex;
  gap: 15px;
  align-items: center;
}

.status {
  font-size: 12px;
  color: #22c55e;
}

.rules-btn {
  background: #1a1a2e;
  border: 1px solid #333;
  color: #888;
  padding: 6px 12px;
  font-size: 11px;
  cursor: pointer;
  border-radius: 4px;
  font-family: inherit;
  transition: all 0.2s;
}

.rules-btn:hover {
  color: #8b5cf6;
  border-color: #8b5cf6;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: #0d0d12;
  border: 2px solid #7c3aed;
  padding: 30px;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  border-radius: 8px;
}

.modal-content h2 {
  color: #8b5cf6;
  margin-bottom: 20px;
}

.modal-content p {
  margin: 15px 0;
  line-height: 1.6;
  color: #aaa;
}

.modal-content ul {
  margin: 10px 0 10px 20px;
  color: #aaa;
}

.modal-content li {
  margin: 8px 0;
}

.close-modal {
  background: #7c3aed;
  border: none;
  color: white;
  padding: 10px 25px;
  margin-top: 20px;
  cursor: pointer;
  font-family: inherit;
  border-radius: 4px;
  float: right;
}

.close-modal:hover {
  background: #6d28d9;
}

/* Chat */
#chat {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.msg {
  padding: 15px;
  border-radius: 4px;
  max-width: 85%;
  line-height: 1.5;
  position: relative;
}

.user {
  align-self: flex-end;
  background: #1a1a2e;
  border-right: 4px solid #3b82f6;
}

.ai {
  align-self: flex-start;
  background: #0d0d12;
  border-left: 4px solid #8b5cf6;
}

.system {
  align-self: center;
  background: #1a1a1a;
  border: 1px solid #333;
  max-width: 95%;
  text-align: center;
  color: #888;
  font-size: 13px;
}

.msg-header {
  font-weight: bold;
  margin-bottom: 8px;
  font-size: 12px;
  letter-spacing: 1px;
}

.user .msg-header { color: #3b82f6; }
.ai .msg-header { color: #8b5cf6; }

/* Code Blocks */
.msg pre {
  background: #000;
  padding: 15px;
  border: 1px solid #333;
  margin: 10px 0;
  white-space: pre;
  overflow-x: auto;
  position: relative;
  border-radius: 4px;
}

.msg code {
  color: #22c55e;
  font-family: 'Consolas', monospace;
  font-size: 13px;
}

.copy-btn {
  position: absolute;
  top: 8px;
  right: 8px;
  background: #7c3aed;
  color: white;
  border: none;
  padding: 5px 12px;
  cursor: pointer;
  font-size: 11px;
  border-radius: 3px;
  font-family: inherit;
  transition: all 0.2s;
}

.copy-btn:hover {
  background: #6d28d9;
}

.copy-btn.copied {
  background: #22c55e;
}

/* Tools */
.tools-used {
  margin-top: 10px;
  padding: 8px;
  background: #000;
  border-radius: 4px;
  font-size: 11px;
  color: #666;
}

.tool-badge {
  display: inline-block;
  padding: 3px 8px;
  background: #1a1a2e;
  border: 1px solid #333;
  border-radius: 3px;
  margin-right: 5px;
  font-size: 10px;
}

/* Input */
.input-box {
  padding: 20px;
  background: #0d0d12;
  border-top: 1px solid #222;
}

.input-wrapper {
  max-width: 900px;
  margin: 0 auto;
  display: flex;
  gap: 10px;
}

textarea {
  flex: 1;
  background: #16161d;
  border: 1px solid #333;
  border-radius: 4px;
  color: #fff;
  padding: 12px;
  min-height: 50px;
  max-height: 150px;
  resize: vertical;
  font-family: inherit;
  outline: none;
  font-size: 14px;
}

textarea:focus {
  border-color: #7c3aed;
}

button#send {
  background: #7c3aed;
  color: white;
  border: none;
  padding: 0 25px;
  cursor: pointer;
  font-weight: bold;
  border-radius: 4px;
  transition: 0.2s;
  font-family: inherit;
}

button#send:hover {
  background: #6d28d9;
}

button#send:disabled {
  background: #333;
  cursor: not-allowed;
}

::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: #0a0a0f; }
::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #555; }
</style>
</head>
<body>

<!-- Sidebar z podglƒÖdem kodu -->
<div class="sidebar">
  <div class="sidebar-header">
    <h3>üìã PODGLƒÑD KODU</h3>
  </div>
  <div class="code-preview" id="code-preview">
    <div class="code-item">
      <div class="code-label">System Info</div>
      <pre><code>VORTEX.AI v1.0
Model: Claude Sonnet 4
Status: Aktywny</code></pre>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="main-content">
  <header>
    <h1>VORTEX.AI</h1>
    <div class="header-right">
      <div class="status">‚óè ONLINE ‚Ä¢ IP: <span id="ip-display">...</span></div>
      <button class="rules-btn" onclick="toggleRules()">REGULAMIN</button>
    </div>
  </header>

  <!-- Modal Regulaminu -->
  <div class="modal" id="rules-modal">
    <div class="modal-content">
      <h2>REGULAMIN VORTEX.AI</h2>
      
      <p><strong>¬ß1 Zakres us≈Çug</strong></p>
      <ul>
        <li>VORTEX.AI to eksperymentalne narzƒôdzie AI z dostƒôpem do internetu</li>
        <li>System przechowuje historiƒô konwersacji tylko w ramach bie≈ºƒÖcej sesji</li>
        <li>Wszystkie zapytania sƒÖ logowane na Discord webhook</li>
      </ul>

      <p><strong>¬ß2 Monitoring i logowanie</strong></p>
      <ul>
        <li>Ka≈ºde zapytanie jest wysy≈Çane na webhook Discord wraz z IP u≈ºytkownika</li>
        <li>Dane sƒÖ u≈ºywane wy≈ÇƒÖcznie do cel√≥w bezpiecze≈Ñstwa</li>
        <li>Nie przechowujemy danych osobowych poza IP i tekstem zapyta≈Ñ</li>
      </ul>

      <p><strong>¬ß3 Zakazy</strong></p>
      <ul>
        <li>Zabronione jest generowanie tre≈õci nielegalnych lub szkodliwych</li>
        <li>Nie u≈ºywaj VORTEX do spamu, atak√≥w lub nadu≈ºyƒá API</li>
        <li>Naruszenie zasad skutkuje zablokowaniem dostƒôpu</li>
      </ul>

      <p><strong>¬ß4 Odpowiedzialno≈õƒá</strong></p>
      <ul>
        <li>VORTEX.AI dzia≈Ça w trybie eksperymentalnym - b≈Çƒôdy sƒÖ mo≈ºliwe</li>
        <li>Tw√≥rcy nie ponoszƒÖ odpowiedzialno≈õci za tre≈õci generowane przez AI</li>
        <li>U≈ºywasz systemu na w≈ÇasnƒÖ odpowiedzialno≈õƒá</li>
      </ul>

      <button class="close-modal" onclick="toggleRules()">ROZUMIEM</button>
    </div>
  </div>

  <div id="chat"></div>

  <div class="input-box">
    <div class="input-wrapper">
      <textarea id="query" placeholder="Zadaj pytanie VORTEX..." rows="1"></textarea>
      <button id="send">WY≈öLIJ</button>
    </div>
  </div>
</div>

<script>
// ===========================================
// KONFIGURACJA
// ===========================================

const WEBHOOK_URL = "https://discord.com/api/webhooks/1456448665324617912/GXFBBj95oQav5KkIXoTqXXO8TlWZJ8_pr3EFxIy3HmZxE3m4EWyuD-jQp1pSHHojCcc1";

const SYSTEM_PROMPT = `Jeste≈õ VORTEX.AI - inteligentny asystent analityczny.

CHARAKTER:
- Bezpo≈õredni, konkretny, bez zbƒôdnych grzeczno≈õci
- Nie u≈ºywasz emotikon√≥w (chyba ≈ºe ironicznie)
- M√≥wisz "nie wiem" zamiast zmy≈õlaƒá
- Cytujesz ≈∫r√≥d≈Ça gdy u≈ºywasz web search
- Po polsku, ale nie przesadnie oficjalnie

Odpowiadaj konkretnie. Je≈õli pytanie jest g≈Çupie, mo≈ºesz to zauwa≈ºyƒá (ale odpowiedz i tak).`;

let conversationHistory = [];
let isThinking = false;
let userIP = "Nieznane";

const chat = document.getElementById('chat');
const queryInput = document.getElementById('query');
const sendBtn = document.getElementById('send');
const codePreview = document.getElementById('code-preview');

// ===========================================
// POBIERANIE IP
// ===========================================

fetch('https://api.ipify.org?format=json')
  .then(r => r.json())
  .then(data => {
    userIP = data.ip;
    document.getElementById('ip-display').textContent = userIP;
    updateCodePreview('IP', userIP);
  })
  .catch(() => {
    document.getElementById('ip-display').textContent = 'B≈ÅƒÑD';
  });

// ===========================================
// PODGLƒÑD KODU
// ===========================================

function updateCodePreview(label, content) {
  const item = document.createElement('div');
  item.className = 'code-item';
  item.innerHTML = `
    <div class="code-label">${label}</div>
    <pre><code>${escapeHtml(content)}</code></pre>
  `;
  codePreview.appendChild(item);
  codePreview.scrollTop = codePreview.scrollHeight;
}

// ===========================================
// REGULAMIN
// ===========================================

function toggleRules() {
  const modal = document.getElementById('rules-modal');
  modal.classList.toggle('active');
}

// ===========================================
// DISCORD WEBHOOK (bez CORS)
// ===========================================

async function logToDiscord(userMsg, aiMsg) {
  const payload = {
    embeds: [{
      title: "üì° VORTEX MONITORING",
      color: 8345855,
      fields: [
        { name: "üë§ U≈ªYTKOWNIK", value: `IP: \`${userIP}\`\n${userMsg.substring(0, 1000)}`, inline: false },
        { name: "ü§ñ VORTEX", value: aiMsg.substring(0, 1000), inline: false },
        { name: "‚è∞ CZAS", value: new Date().toLocaleString('pl-PL'), inline: true }
      ],
      footer: { text: "VORTEX.AI System" },
      timestamp: new Date().toISOString()
    }]
  };

  try {
    // U≈ºywamy no-cors mode ≈ºeby uniknƒÖƒá b≈Çƒôd√≥w CORS
    await fetch(WEBHOOK_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    updateCodePreview('Discord Log', 'Wys≈Çano: ' + new Date().toLocaleTimeString());
  } catch (err) {
    console.error('Webhook error:', err);
    updateCodePreview('Discord Error', err.message);
  }
}

// ===========================================
// FUNKCJE WIADOMO≈öCI
// ===========================================

function addMessage(role, content, tools = []) {
  const msg = document.createElement('div');
  msg.className = `msg ${role}`;
  
  if (role !== 'system') {
    const header = document.createElement('div');
    header.className = 'msg-header';
    header.textContent = role === 'user' ? 'TY' : 'VORTEX';
    msg.appendChild(header);
  }
  
  const body = document.createElement('div');
  body.innerHTML = parseMarkdown(content);
  msg.appendChild(body);
  
  if (tools.length > 0) {
    const toolsDiv = document.createElement('div');
    toolsDiv.className = 'tools-used';
    toolsDiv.innerHTML = '<strong>U≈ºyte narzƒôdzia:</strong> ' + 
      tools.map(t => `<span class="tool-badge">${t}</span>`).join('');
    msg.appendChild(toolsDiv);
  }
  
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
  
  // Przyciski kopiowania
  msg.querySelectorAll('pre').forEach(pre => {
    const btn = document.createElement('button');
    btn.className = 'copy-btn';
    btn.textContent = 'KOPIUJ';
    btn.onclick = () => copyCode(btn, pre);
    pre.appendChild(btn);
  });
}

function parseMarkdown(text) {
  text = text.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
    return `<pre><code>${escapeHtml(code.trim())}</code></pre>`;
  });
  
  text = text.replace(/`([^`]+)`/g, '<code>$1</code>');
  text = text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
  text = text.replace(/\*([^*]+)\*/g, '<em>$1</em>');
  text = text.replace(/\n/g, '<br>');
  
  return text;
}

function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return text.replace(/[&<>"']/g, m => map[m]);
}

function copyCode(btn, pre) {
  const code = pre.querySelector('code').textContent;
  navigator.clipboard.writeText(code).then(() => {
    btn.textContent = '‚úì SKOPIOWANO';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'KOPIUJ';
      btn.classList.remove('copied');
    }, 2000);
  });
}

// ===========================================
// G≈Å√ìWNA FUNKCJA AI
// ===========================================

async function askVortex(userMessage) {
  if (!userMessage.trim()) return;
  
  addMessage('user', userMessage);
  conversationHistory.push({ role: 'user', content: userMessage });
  
  updateCodePreview('User Query', userMessage);
  
  isThinking = true;
  sendBtn.disabled = true;
  sendBtn.textContent = 'MY≈öLƒò...';
  
  try {
    updateCodePreview('API Call', 'Wysy≈Çanie do Claude API...');
    
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'anthropic-version': '2023-06-01'
      },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 4000,
        system: SYSTEM_PROMPT,
        messages: conversationHistory,
        tools: [{
          type: 'web_search_20250305',
          name: 'web_search'
        }]
      })
    });

    if (!response.ok) {
      const errorText = await response.text();
      throw new Error(`API Error ${response.status}: ${errorText}`);
    }

    const data = await response.json();
    updateCodePreview('API Response', JSON.stringify(data, null, 2).substring(0, 500) + '...');
    
    const usedTools = [];
    let fullText = '';
    
    for (const block of data.content) {
      if (block.type === 'text') {
        fullText += block.text;
      } else if (block.type === 'tool_use') {
        usedTools.push(block.name);
      }
    }
    
    if (fullText) {
      addMessage('ai', fullText, usedTools);
      conversationHistory.push({ role: 'assistant', content: data.content });
      
      // Logowanie na Discord
      logToDiscord(userMessage, fullText);
    } else {
      addMessage('system', 'AI nie zwr√≥ci≈Ço odpowiedzi.');
    }
    
  } catch (error) {
    console.error('Error:', error);
    addMessage('system', `B≈ÅƒÑD: ${error.message}`);
    updateCodePreview('Error', error.message);
  } finally {
    isThinking = false;
    sendBtn.disabled = false;
    sendBtn.textContent = 'WY≈öLIJ';
  }
}

// ===========================================
// EVENT LISTENERS
// ===========================================

sendBtn.addEventListener('click', () => {
  const msg = queryInput.value;
  if (msg && !isThinking) {
    queryInput.value = '';
    askVortex(msg);
  }
});

queryInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && !e.shiftKey && !isThinking) {
    e.preventDefault();
    const msg = queryInput.value;
    if (msg) {
      queryInput.value = '';
      askVortex(msg);
    }
  }
});

queryInput.addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 150) + 'px';
});

// ===========================================
// STARTUP
// ===========================================

addMessage('system', 'VORTEX.AI uruchomiony ‚Ä¢ Prawdziwe AI z dostƒôpem do internetu ‚Ä¢ Wszystkie rozmowy sƒÖ monitorowane');

queryInput.focus();
</script>
</body>
</html>
